# Test Database Migration Scripts

This directory contains database migration scripts for setting up Oracle test environments.

## Usage

```bash
# Activate Python environment first
source /home/ec2-user/python_env/dev/bin/activate

# Run migrations
python tests/scripts/migrate.py --env 23ai
python tests/scripts/migrate.py --env 19c

# Check migration status
python tests/scripts/migrate.py --env 23ai --status

# Force re-run a specific migration
python tests/scripts/migrate.py --env 23ai --force 001_create_sample_datatypes
```

## Table: `sample_datatypes_tbl`

A comprehensive test table with **21 columns** covering all major Oracle data types.

### Column Definitions

| Column | Type | Description |
|--------|------|-------------|
| `id` | NUMBER(10) | Primary key |
| `char_col` | CHAR(20) | Fixed-length character |
| `varchar2_col` | VARCHAR2(200) | Variable-length character |
| `nchar_col` | NCHAR(20) | Fixed-length national character |
| `nvarchar2_col` | NVARCHAR2(200) | Variable-length national character |
| `long_col` | LONG | Long text (deprecated, but tested) |
| `number_col` | NUMBER(38,10) | Number with precision and scale |
| `number_int_col` | NUMBER(10) | Integer-only number |
| `number_free_col` | NUMBER | Free-form number (no precision/scale) |
| `binary_float_col` | BINARY_FLOAT | 32-bit IEEE floating point |
| `binary_double_col` | BINARY_DOUBLE | 64-bit IEEE floating point |
| `date_col` | DATE | Date and time |
| `timestamp_col` | TIMESTAMP(9) | Timestamp with nanoseconds |
| `timestamp_tz_col` | TIMESTAMP(9) WITH TIME ZONE | Timestamp with time zone |
| `timestamp_ltz_col` | TIMESTAMP(9) WITH LOCAL TIME ZONE | Timestamp with local time zone |
| `interval_ds_col` | INTERVAL DAY(9) TO SECOND(9) | Day-to-second interval |
| `interval_ym_col` | INTERVAL YEAR(9) TO MONTH | Year-to-month interval |
| `clob_col` | CLOB | Character large object |
| `nclob_col` | NCLOB | National character large object |
| `blob_col` | BLOB | Binary large object |
| `raw_col` | RAW(2000) | Raw binary data |

### Test Data: 500 Rows

#### Special Test Rows (1-20): Edge Cases

| Row | Description |
|-----|-------------|
| 1 | **All NULLs** (except ID) |
| 2 | **Empty/Zero values**: Empty strings, zeros, EMPTY_LOB(), Unix epoch date |
| 3 | **Large positive values**: Max NUMBER, large floats, year 9999 |
| 4 | **Large negative values**: Negative extremes |
| 5 | **Very small floats**: Near-zero positive values (1E-38, etc.) |
| 6 | **Unicode characters**: Latin (ÀÁ), CJK (中文), emoji support test |
| 7 | **Typical business data**: Names, addresses, realistic values |
| 8 | **Y2K boundary**: Date 2000-01-01 |
| 9 | **Leap year**: February 29, 2024 |
| 10 | **Mixed NULLs pattern 1**: Alternating NULL/non-NULL columns |
| 11 | **Mixed NULLs pattern 2**: Opposite pattern of row 10 |
| 12 | **High precision numbers**: Pi (40+ digits), sqrt(2) |
| 13 | **Scientific notation**: 1.23E+20, 1E+100, 1E+50 |
| 14 | **Negative intervals**: -5 days, -10 years |
| 15 | **All LOBs NULL**: CLOB, NCLOB, BLOB all NULL |
| 16 | **Large CLOB**: 32KB CLOB and NCLOB content |
| 17 | **Whitespace**: Leading/trailing spaces |
| 18 | **Control characters**: Newlines (CHR(10)), tabs (CHR(9)), CRLF |
| 19 | **SQL special chars**: Single quotes (O'Brien), double quotes |
| 20 | **Binary patterns**: Hex sequences 00-1F, FF-F0 |

#### Bulk Test Rows (21-500): Random Varied Data

- **480 rows** with randomized data
- ~10% NULL probability for most columns
- Every 10th row has 50% NULL probability
- Varied string lengths, number ranges, dates spanning 1900-2100
- Different LOB sizes (0, 10, 100, 1000, 4000 chars)
- Reproducible randomness (seed=42)

### Oracle NUMBER (Free) Column

The `number_free_col` uses Oracle's `NUMBER` type without precision or scale constraints. This tests Oracle's behavior with:

- Arbitrary precision decimals (up to 38 digits)
- Automatic precision detection
- Scientific notation storage
- Integer vs decimal representation

Test values include:
- Pi with 20+ decimals
- Euler's number (e)
- Square root of 2
- Scientific notation (1.23E+50)
- Repeating decimals (17.171717...)
- Very small decimals (0.000...0001)

### Types NOT Included

- **BFILE**: Requires external file system setup
- **XMLTYPE**: Complex nested structure
- **JSON**: Oracle 23ai only
- **VECTOR**: Oracle 23ai only
- **Object types**: Require custom type definitions
- **REF CURSOR**: Not a storage type
- **ROWID/UROWID**: Generated by Oracle, not inserted

## Environment Variables

Set these in `tests/.env`:

```env
# 23ai (Docker)
ORACLE_23AI_HOST=localhost
ORACLE_23AI_PORT=1521
ORACLE_23AI_SERVICE=freepdb1
ORACLE_23AI_PASSWORD=<your_password>
ORACLE_PWD=<sys_password>

# 19c (RDS)
ORACLE_19C_HOST=<rds_endpoint>
ORACLE_19C_PORT=1521
ORACLE_19C_SERVICE=pdb1
ORACLE_19C_USERNAME=admin
ORACLE_19C_PASSWORD=<your_password>
```

## Compatibility

- **Oracle 19c**: Fully compatible (RDS tested)
- **Oracle 23ai**: Fully compatible (Docker tested)
